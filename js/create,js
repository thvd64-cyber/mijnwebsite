// 1. Haal bestaande stamboom data op of start met lege array
let stamboomData = JSON.parse(localStorage.getItem('stamboomData') || '[]');

// 2. Elementen uit de HTML
const form = document.getElementById('addPersonForm');       // het formulier
const preview = document.getElementById('stamboomPreview');  // div voor preview

// 3. Functie om een unieke ID te maken
function generateID() {
    return 'p' + Date.now(); // gebruikt timestamp voor uniek ID
}

// 4. Voeg persoon toe bij submit
form.addEventListener('submit', function(e){
    e.preventDefault(); // voorkomt dat de pagina refresh bij submit

    // 5. Maak persoon-object
    const person = {
        ID: generateID(),
        voornaam: document.getElementById('voornaam').value,
        roepnaam: document.getElementById('roepnaam').value,
        prefix: document.getElementById('prefix').value,
        achternaam: document.getElementById('achternaam').value,
        geboorte: document.getElementById('geboorte').value, // calendar picker
        geslacht: document.getElementById('geslacht').value,
        ouderID: null,
        partnerID: null
    };

    // 6. RootPerson check
    if(stamboomData.length === 0){
        const rootPerson = person;
        stamboomData = [rootPerson]; // eerste persoon wordt root
    } else {
        stamboomData.push(person); // extra personen toevoegen
    }

    // 7. Opslaan in localStorage
    localStorage.setItem('stamboomData', JSON.stringify(stamboomData));

    // 8. Render preview
    renderStamboom();

    // 9. Reset formulier
    form.reset();
});

// 10. Render stamboom preview
function renderStamboom(){
    preview.innerHTML = ''; // leegmaken van oude preview
    if(stamboomData.length === 0){
        preview.innerHTML = '<p>Geen leden toegevoegd. Voeg de eerste persoon toe.</p>';
        return;
    }
    stamboomData.forEach(p => {
        const div = document.createElement('div');
        div.className = 'node';

        // Alleen het jaar tonen uit de kalender datum
        let geboortejaar = p.geboorte ? p.geboorte.split('-')[0] : '';

        div.textContent = `${p.voornaam} "${p.roepnaam}" ${p.prefix} ${p.achternaam} (${geboortejaar})`;
        preview.appendChild(div);
    });
}

// 11. Init render
renderStamboom();
