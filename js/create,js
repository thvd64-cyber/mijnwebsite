// Haal data op of start met lege array
let stamboomData = JSON.parse(localStorage.getItem('stamboomData') || '[]');

// Elementen
const form = document.getElementById('addPersonForm');
const preview = document.getElementById('stamboomPreview');

// Functie om ID te genereren
function generateID() {
    return 'p' + Date.now();
}

// Voeg persoon toe
form.addEventListener('submit', function(e){
    e.preventDefault();
    
    const person = {
        ID: generateID(),
        doopnaam: document.getElementById('doopnaam').value,   // voornaam / doopnaam
        roepnaam: document.getElementById('roepnaam').value,   // roepnaam
        prefix: document.getElementById('prefix').value,       // bv van, de
        achternaam: document.getElementById('achternaam').value,
        geboorte: document.getElementById('geboorte').value,
        geslacht: document.getElementById('geslacht').value,
        ouderID: null,
        partnerID: null
    };

    // Als er nog geen stamboomData is, slaan we dit als rootPerson op
    if(stamboomData.length === 0){
        const rootPerson = person;
        stamboomData = [rootPerson]; // start array met rootPerson
    } else {
        // anders gewoon toevoegen
        stamboomData.push(person);
    }

    // Opslaan in localStorage
    localStorage.setItem('stamboomData', JSON.stringify(stamboomData));

    // Render preview
    renderStamboom();

    // Reset form
    form.reset();
});

// Render stamboom preview
function renderStamboom(){
    preview.innerHTML = '';
    if(stamboomData.length === 0){
        preview.innerHTML = '<p>Geen leden toegevoegd. Voeg de eerste persoon toe.</p>';
        return;
    }
    stamboomData.forEach(p => {
        const div = document.createElement('div');
        div.className = 'node';
        let fullName = `${p.doopnaam} (${p.roepnaam}) `;
        if(p.prefix) fullName += p.prefix + ' ';
        fullName += p.achternaam;
        if(p.geboorte) fullName += ` (${p.geboorte})`;
        div.textContent = fullName;
        preview.appendChild(div);
    });
}

// Init render
renderStamboom();
