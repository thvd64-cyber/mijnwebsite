<!-- ======================= stamboom/stats.html (volledige KPI dashboard) ======================= -->
<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8"> <!-- Tekencodering UTF-8 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Responsief -->
    <title>MyFamTreeCollab - Statistiek</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>

<!-- TopBar -->
<div id="topbar-placeholder"></div>
<script>
fetch('/MyFamTreeCollab/Layout/TopBar.html')
  .then(resp => resp.text())
  .then(data => document.getElementById('topbar-placeholder').innerHTML = data);
</script>

<!-- Navbar -->
<div id="Navbar-placeholder"></div>
<script>
fetch('/MyFamTreeCollab/Layout/Navbar.html')
  .then(resp => resp.text())
  .then(data => {
    const placeholder = document.getElementById('Navbar-placeholder');
    if (placeholder) placeholder.innerHTML = data;
    else console.error('Navbar-placeholder niet gevonden');
  });
</script>

<!-- Pagina Titel -->
<div id="pageTitle" style="font-size:1.5rem; font-weight:bold; margin-bottom:15px;"></div>
<script>
document.addEventListener('DOMContentLoaded', () => {
    const pageTitleDiv = document.getElementById('pageTitle'); 
    const title = "Stamboom Statistieken"; 
    pageTitleDiv.textContent = title.replace(/[-_]/g,' ').replace(/\b\w/g, c=>c.toUpperCase());
});
</script>

<!-- ======================= KPI-blokken ======================= -->
<section id="kpiContainer" style="display:flex; flex-wrap:wrap; gap:20px; margin-top:20px;"></section>

<!-- ======================= Familie Overzicht ======================= -->
<section id="familiesContainer" style="margin-top:20px; padding:20px; background:#fff; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.05);">
    <h2>Overzicht FamilieÃ«n</h2>
    <ul id="familyList" style="margin-left:20px; line-height:1.6;"></ul>
</section>

<!-- CSS voor KPI-blokken -->
<style>
.kpi-block { flex:1; min-width:200px; padding:20px; border-radius:8px; text-align:center; box-shadow:0 2px 4px rgba(0,0,0,0.1); transition: transform 0.2s; }
.kpi-block:hover { transform: translateY(-3px); }
.kpi-value { font-size:2rem; font-weight:bold; margin-bottom:5px; }
.kpi-label { font-size:1rem; color:#555; }
.kpi-persons { background:#007bff; color:#fff; }
.kpi-update { background:#28a745; color:#fff; }
.kpi-version { background:#ffc107; color:#fff; }
.kpi-generations { background:#17a2b8; color:#fff; }
.kpi-mostcommon { background:#6f42c1; color:#fff; }
.kpi-gender { background:#fd7e14; color:#fff; }
.kpi-families { background:#e83e8c; color:#fff; }
</style>

<!-- Scripts -->
<script src="../js/storage.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function(){

    if(typeof StamboomStorage === "undefined"){ console.error("StamboomStorage niet geladen."); return; }

    const data = StamboomStorage.get(); // Alle personen ophalen
    const lastUpdate = localStorage.getItem('lastUpdate') || 'Onbekend';
    const version = StamboomStorage.version;
    const kpiContainer = document.getElementById('kpiContainer');
    const familyList = document.getElementById('familyList');

    // Functie om KPI blok te maken
    function createKPI(value, label, extraClass){
        const div = document.createElement('div');
        div.classList.add('kpi-block');
        if(extraClass) div.classList.add(extraClass);
        const valSpan = document.createElement('div');
        valSpan.classList.add('kpi-value');
        valSpan.textContent = value;
        const labelSpan = document.createElement('div');
        labelSpan.classList.add('kpi-label');
        labelSpan.textContent = label;
        div.appendChild(valSpan);
        div.appendChild(labelSpan);
        return div;
    }

    // ===============================
    // Bereken extra statistieken
    // ===============================

    // Generaties (aannames: veld 'Generation' bestaat)
    const generations = new Set(data.map(p => p.Generation)).size;

    // Meest voorkomende achternaam
    const surnameCounts = {};
    data.forEach(p => { surnameCounts[p.Achternaam] = (surnameCounts[p.Achternaam] || 0) +1; });
    let mostCommonSurname = '';
    let maxCount = 0;
    for(const [name, count] of Object.entries(surnameCounts)){
        if(count > maxCount){ maxCount = count; mostCommonSurname = name; }
    }

    // Aantal man/vrouw (velden 'Geslacht' verwacht: M/V)
    const genderCounts = data.reduce((acc,p)=>{ 
        if(p.Geslacht==='M') acc.M++; 
        else if(p.Geslacht==='V') acc.V++; 
        return acc; 
    }, {M:0,V:0});

    // Families & familieleden
    const families = {}; // groep op Achternaam
    data.forEach(p=>{
        if(!families[p.Achternaam]) families[p.Achternaam]=[];
        families[p.Achternaam].push(p);
    });
    const familyCount = Object.keys(families).length;

    // ===============================
    // Voeg KPI-blokken toe
    // ===============================
    kpiContainer.appendChild(createKPI(data.length,'Aantal Personen','kpi-persons'));
    kpiContainer.appendChild(createKPI(lastUpdate,'Laatste Update','kpi-update'));
    kpiContainer.appendChild(createKPI(version,'Versie','kpi-version'));
    kpiContainer.appendChild(createKPI(generations,'Aantal Generaties','kpi-generations'));
    kpiContainer.appendChild(createKPI(mostCommonSurname,'Meest Voorkomende Achternaam','kpi-mostcommon'));
    kpiContainer.appendChild(createKPI(`${genderCounts.M}M / ${genderCounts.V}V`,'Man/Vrouw','kpi-gender'));
    kpiContainer.appendChild(createKPI(familyCount,'Aantal Families','kpi-families'));

    // ===============================
    // Familie-overzicht lijst
    // ===============================
    Object.entries(families).forEach(([familyName, members])=>{
        const li = document.createElement('li');
        li.textContent = `${familyName} (${members.length} leden)`;
        familyList.appendChild(li);
    });

});
</script>

<!-- Footer -->
<div id="footer-placeholder"></div>
<script>
fetch('/MyFamTreeCollab/Layout/Footer.html')
    .then(resp=>resp.text())
    .then(data=>{ document.getElementById('footer-placeholder').innerHTML = data; });
</script>

</body>
</html>
