<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8"> <!-- Tekencodering UTF-8 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Responsief -->
    <title>MyFamTreeCollab - Import</title> <!-- Browser tab titel -->
    <link rel="stylesheet" href="../css/style.css"> <!-- CSS koppeling -->
</head>
<body>

<!-- ======================= TopBar ======================= -->
<div id="topbar-placeholder"></div>
<script>
fetch('/MyFamTreeCollab/Layout/TopBar.html')
    .then(resp => resp.text())
    .then(data => document.getElementById('topbar-placeholder').innerHTML = data);
</script>

<!-- ======================= Navbar ======================= -->
<div id="Navbar-placeholder"></div>
<script>
fetch('/MyFamTreeCollab/Layout/Navbar.html')
    .then(resp => resp.text())
    .then(data => document.getElementById('Navbar-placeholder').innerHTML = data);
</script>

<!-- ======================= Pagina Titel ======================= -->
<div id="pageTitle" style="font-size:1.5rem;font-weight:bold;margin-bottom:15px;">Import</div>

<!-- ======================= MAIN ======================= -->
<main>
    <div class="container">

        <!-- File select + Import knop -->
        <input type="file" id="importFile" accept=".csv"> 
        <button id="importBtn">Importeer CSV</button>

        <!-- Status & aantal records -->
        <p id="importStatus"></p>
        <p id="recordCount"></p> <!-- toont totaal aantal personen -->

        <!-- Preview tabel (optioneel, zoals manage) -->
        <table id="previewTable">
            <thead>
                <tr>
                    <th>Relatie</th>
                    <!-- overige headers worden dynamisch via JS -->
                </tr>
            </thead>
            <tbody></tbody>
        </table>

    </div>
</main>

<!-- ======================= Import Script ======================= -->
<script src="import.js"></script>

<!-- ======================= Footer ======================= -->
<div id="footer-placeholder"></div>
<script>
fetch('/MyFamTreeCollab/Layout/Footer.html')
    .then(resp => resp.text())
    .then(data => document.getElementById('footer-placeholder').innerHTML = data);
</script>

<script>
// ======================= Dynamische preview =======================
document.addEventListener('DOMContentLoaded', () => {

    const recordCount = document.getElementById('recordCount'); // teller
    const previewBody = document.querySelector('#previewTable tbody');
    const headers = window.StamboomSchema.fields || []; // gebruik schema voor kolommen

    // Bouw table headers dynamisch
    const theadRow = document.querySelector('#previewTable thead tr');
    theadRow.innerHTML = '<th>Relatie</th>';
    headers.forEach(h => {
        const th = document.createElement('th');
        th.textContent = h;
        theadRow.appendChild(th);
    });

    // functie om preview te tonen na import
    function renderPreview(data) {
        previewBody.innerHTML = ''; // reset tabel
        data.forEach(p => {
            const tr = document.createElement('tr');
            tr.innerHTML = '<td>-</td>'; // Relatie leeg bij import
            headers.forEach(h => {
                const td = document.createElement('td');
                td.textContent = p[h] || '';
                tr.appendChild(td);
            });
            previewBody.appendChild(tr);
        });
        recordCount.textContent = `Aantal personen in storage: ${data.length}`;
    }

    // luister op succesvolle import via StamboomStorage
    document.getElementById('importBtn').addEventListener('click', () => {
        // korte delay om storage te laten updaten
        setTimeout(() => {
            const data = window.StamboomStorage.get() || [];
            renderPreview(data);
        }, 200);
    });
});
</script>
